<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign-out Functionality Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #3b82f6;
            background: #f8fafc;
        }
        .expected {
            border-left-color: #10b981;
            background: #ecfdf5;
        }
        .instructions {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .iframe-container {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            height: 600px;
            margin: 20px 0;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 600;
        }
        .success { background: #dcfce7; color: #166534; }
        .error { background: #fee2e2; color: #991b1b; }
        .info { background: #dbeafe; color: #1d4ed8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Sign-out Functionality Test</h1>
        <p>This test verifies that the sign-out feature now works correctly after the fix.</p>

        <div class="instructions">
            <h3>üìã Test Instructions</h3>
            <ol>
                <li>Open the application in the iframe below</li>
                <li>Log in with your credentials</li>
                <li>Click the profile button (top right)</li>
                <li>Click "Sign Out" in the dropdown</li>
                <li>Observe the behavior</li>
            </ol>
        </div>

        <div class="step">
            <h3>‚úÖ Expected Behavior (After Fix)</h3>
            <ul>
                <li>User is redirected to a login/welcome page</li>
                <li>No longer sees the dashboard</li>
                <li>Can log back in if desired</li>
                <li>LocalStorage is cleared of auth data</li>
            </ul>
        </div>

        <div class="step expected">
            <h3>‚ùå Previous Broken Behavior</h3>
            <ul>
                <li>User clicked "Sign Out" but nothing happened</li>
                <li>Page redirected but user ended up back in dashboard</li>
                <li>Appeared as if sign-out was broken</li>
            </ul>
        </div>

        <div class="iframe-container">
            <iframe src="http://localhost:5174/" title="Productivity Dashboard"></iframe>
        </div>

        <div id="test-results">
            <h3>üß™ Test Results</h3>
            <div id="status-container"></div>
        </div>

        <div class="instructions">
            <h3>üîç Console Debug Commands</h3>
            <p>Open browser console and run these commands to verify the fix:</p>
            <pre><code>
// Check authentication status
localStorage.getItem('current_user_session_id');

// Check for any remaining auth data
Object.keys(localStorage).filter(key => key.includes('session') || key.includes('auth') || key.includes('user'));

// Test sign-out manually
window.location.href = '/';
            </code></pre>
        </div>
    </div>

    <script>
        function addStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(status);
        }

        // Test results collector
        window.addEventListener('message', (event) => {
            // Listen for messages from iframe about authentication status
            if (event.data && event.data.type === 'auth-status') {
                addStatus(`Auth status: ${event.data.authenticated ? 'Authenticated' : 'Not authenticated'}`, event.data.authenticated ? 'success' : 'info');
            }
        });

        addStatus('Test page loaded. Ready to begin sign-out verification.', 'info');
    </script>
</body>
</html>