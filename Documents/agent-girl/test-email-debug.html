<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Email Sending</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .result { background: #e8f5e8; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe8e8; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input { padding: 8px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>üîß Supabase Email Debug Tool</h1>

    <div class="test-section">
        <h2>Step 1: Test Supabase Connection</h2>
        <button onclick="testSupabaseConnection()">Test Connection</button>
        <div id="connection-result"></div>
    </div>

    <div class="test-section">
        <h2>Step 2: Send Test Verification Email</h2>
        <input type="email" id="test-email" placeholder="Enter your email" value="">
        <button onclick="sendTestEmail()">Send Test Email</button>
        <div id="email-result"></div>
    </div>

    <div class="test-section">
        <h2>Step 3: Check Auth Settings</h2>
        <button onclick="checkAuthSettings()">Check Settings</button>
        <div id="settings-result"></div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://vacwojgxafujscxuqmpg.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhY3dvamd4YWZ1anNjeHVxbXBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxOTU5MTksImV4cCI6MjA3Nzc3MTkxOX0.RniyufeNXF9h6a9u55zGIxLRFeFDCaJxQ1ZjLv6KgxI';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

        function testSupabaseConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '<div class="result">üîÑ Testing connection...</div>';

            try {
                console.log('üî• Testing Supabase connection...');
                console.log('üìä URL:', supabaseUrl);
                console.log('üîë Auth client ready:', !!supabase.auth);

                resultDiv.innerHTML = '<div class="result">‚úÖ Supabase connection successful!</div>';
            } catch (error) {
                console.error('‚ùå Connection failed:', error);
                resultDiv.innerHTML = `<div class="error">‚ùå Connection failed: ${error.message}</div>`;
            }
        }

        async function sendTestEmail() {
            const email = document.getElementById('test-email').value;
            const resultDiv = document.getElementById('email-result');

            if (!email) {
                resultDiv.innerHTML = '<div class="error">‚ùå Please enter an email address</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">üîÑ Sending test email...</div>';

            try {
                console.log('üî• Sending test verification email to:', email);

                const { data, error } = await supabase.auth.resend({
                    type: 'signup',
                    email: email,
                    options: {
                        emailRedirectTo: window.location.origin + '/',
                    }
                });

                if (error) {
                    console.error('‚ùå Email send failed:', error);
                    resultDiv.innerHTML = `<div class="error">‚ùå Email send failed: ${error.message}</div>`;
                } else {
                    console.log('‚úÖ Email sent successfully:', data);
                    resultDiv.innerHTML = '<div class="result">‚úÖ Test email sent! Check your inbox (and spam folder).</div>';
                }

            } catch (err) {
                console.error('‚ùå Unexpected error:', err);
                resultDiv.innerHTML = `<div class="error">‚ùå Unexpected error: ${err.message}</div>`;
            }
        }

        async function checkAuthSettings() {
            const resultDiv = document.getElementById('settings-result');
            resultDiv.innerHTML = '<div class="result">üîÑ Checking auth settings...</div>';

            try {
                // Test signup to see if email confirmation is required
                const testEmail = 'test+' + Date.now() + '@example.com';
                const { data, error } = await supabase.auth.signUp({
                    email: testEmail,
                    password: 'testpassword123',
                    options: {
                        emailRedirectTo: window.location.origin + '/',
                    }
                });

                if (error) {
                    console.log('‚ùå Signup test failed:', error);
                    resultDiv.innerHTML = `<div class="error">‚ùå Signup test failed: ${error.message}</div>`;
                } else {
                    console.log('üîç Signup response:', data);

                    if (data.user && !data.user.email_confirmed_at) {
                        resultDiv.innerHTML = '<div class="result">‚úÖ Email confirmation is ENABLED ‚úÖ<br>Verification emails should be sent.</div>';
                    } else if (data.user && data.user.email_confirmed_at) {
                        resultDiv.innerHTML = '<div class="error">‚ùå Email confirmation is DISABLED ‚ùå<br>Users are automatically verified without email.</div>';
                    } else {
                        resultDiv.innerHTML = '<div class="result">‚úÖ Settings check completed - see console for details</div>';
                    }
                }

            } catch (err) {
                console.error('‚ùå Settings check failed:', err);
                resultDiv.innerHTML = `<div class="error">‚ùå Settings check failed: ${err.message}</div>`;
            }
        }

        // Auto-test connection on page load
        window.onload = function() {
            testSupabaseConnection();
        };
    </script>
</body>
</html>