[build]
builder = "NIXPACKS"

[deploy]
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

[env]
NODE_ENV = "production"
PORT = "3000"

[[services]]
name = "app"

[services.variables]
DATABASE_URL = "${{DATABASE_URL}}"
NEXTAUTH_URL = "${{NEXTAUTH_URL}}"
NEXTAUTH_SECRET = "${{NEXTAUTH_SECRET}}"
REDIS_URL = "${{REDIS_URL}}"

[services.health_checks]
[services.health_checks.http]
path = "/api/health"
port = 3000
interval = "15s"
timeout = "10s"
retries = 3