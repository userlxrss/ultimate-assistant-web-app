<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Password Reset Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">Password Reset Fix Test</h1>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test the Enhanced Reset Parser</h2>

            <div class="space-y-4">
                <div>
                    <p class="text-sm text-gray-600 mb-2">Click these test links to verify the password reset page now correctly detects reset tokens:</p>
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <!-- Test Link 1: Hash format -->
                    <div class="border rounded p-4">
                        <h3 class="font-semibold mb-2">Test 1: Hash Format (Most Common)</h3>
                        <p class="text-sm text-gray-600 mb-2">This is the format Supabase typically uses</p>
                        <a href="http://localhost:3001/reset-password.html#access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzYyMTk5NTE5LCJzdWIiOiJmMzBkZjI3ZS1iMWNmLTQyY2YtOGU3ZC0yZGQxMjU3OGM5YmUiLCJlbWFpbCI6InRlc3RAZXhhbXBsZS5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6e30sInVzZXJfbWV0YWRhdGEiOnt9LCJyb2xlIjoiYW5vbiIsImFhIjoiYWFlIiwiYW1yIjpbXX0.test123&refresh_token=refresh-test-123&type=recovery&email=test%40example.com"
                           class="inline-block px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                            Test Hash Format Reset Link
                        </a>
                    </div>

                    <!-- Test Link 2: Query format -->
                    <div class="border rounded p-4">
                        <h3 class="font-semibold mb-2">Test 2: Query Format</h3>
                        <p class="text-sm text-gray-600 mb-2">Alternative format if tokens are in query parameters</p>
                        <a href="http://localhost:3001/reset-password.html?access_token=test-access-token-12345&refresh_token=test-refresh-token-67890&type=recovery&email=test%40example.com"
                           class="inline-block px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
                            Test Query Format Reset Link
                        </a>
                    </div>

                    <!-- Test Link 3: Recovery type only -->
                    <div class="border rounded p-4">
                        <h3 class="font-semibold mb-2">Test 3: Recovery Type Only</h3>
                        <p class="text-sm text-gray-600 mb-2">Tests handling of recovery type without access token</p>
                        <a href="http://localhost:3001/reset-password.html?type=recovery&email=test%40example.com"
                           class="inline-block px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">
                            Test Recovery Type Link
                        </a>
                    </div>

                    <!-- Test Link 4: Legacy format -->
                    <div class="border rounded p-4">
                        <h3 class="font-semibold mb-2">Test 4: Legacy Format</h3>
                        <p class="text-sm text-gray-600 mb-2">Tests backward compatibility with old token format</p>
                        <a href="http://localhost:3001/reset-password.html?token=legacy-reset-token-123&email=test%40example.com"
                           class="inline-block px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">
                            Test Legacy Format Link
                        </a>
                    </div>

                    <!-- Test Link 5: Invalid link (should show email request) -->
                    <div class="border rounded p-4">
                        <h3 class="font-semibold mb-2">Test 5: Invalid Link (Control Test)</h3>
                        <p class="text-sm text-gray-600 mb-2">This should show the email request form (no reset tokens)</p>
                        <a href="http://localhost:3001/reset-password.html"
                           class="inline-block px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                            Test Invalid Link (Should Show Email Form)
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Test Instructions</h2>
            <ol class="list-decimal list-inside space-y-2 text-sm">
                <li>Open browser developer tools (F12) and go to the Console tab</li>
                <li>Click each test link above</li>
                <li>Observe the console output - you should see detailed URL parsing logs</li>
                <li>Verify that the correct form is shown (password reset form vs email request form)</li>
                <li>For valid reset links, you should see the password input fields</li>
                <li>For invalid links, you should see the email request form</li>
            </ol>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Expected Results</h2>
            <div class="space-y-3">
                <div class="flex items-start">
                    <div class="w-4 h-4 bg-green-500 rounded-full mt-1 mr-3"></div>
                    <div>
                        <h3 class="font-semibold">Tests 1-4:</h3>
                        <p class="text-sm text-gray-600">Should show password reset form with "Create new password for test@example.com"</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="w-4 h-4 bg-gray-500 rounded-full mt-1 mr-3"></div>
                    <div>
                        <h3 class="font-semibold">Test 5:</h3>
                        <p class="text-sm text-gray-600">Should show email request form with "Enter your email address to receive a password reset link"</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="w-4 h-4 bg-blue-500 rounded-full mt-1 mr-3"></div>
                    <div>
                        <h3 class="font-semibold">Console Logs:</h3>
                        <p class="text-sm text-gray-600">Should see detailed URL analysis with "âœ… Valid reset flow detected"</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 text-center">
            <a href="http://localhost:3001/reset-password.html" class="inline-block px-6 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600">
                Go to Reset Password Page
            </a>
        </div>
    </div>

    <script>
        // Auto-open a new tab to test the URL parsing
        console.log('ðŸ§ª Password Reset Fix Test Page Loaded');
        console.log('ðŸ“‹ Instructions:');
        console.log('1. Click the test links above');
        console.log('2. Open browser dev tools (F12) and check the console');
        console.log('3. Verify the correct form is displayed');
        console.log('4. Check the URL parsing logs for detailed analysis');
    </script>
</body>
</html>