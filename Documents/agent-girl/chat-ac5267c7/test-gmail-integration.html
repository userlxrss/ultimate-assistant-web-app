<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Gmail Integration Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .glass-dark {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-6 text-white">
            <h1 class="text-3xl font-bold mb-2">üöÄ Real Gmail Integration Test</h1>
            <p class="text-blue-100">Career-Critical Gmail IMAP/SMTP Validation</p>
        </div>

        <!-- Connection Status -->
        <div class="glass rounded-xl p-6 mb-6 text-white">
            <h2 class="text-xl font-semibold mb-4">üîß System Status</h2>
            <div id="status-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Status will be populated here -->
            </div>
        </div>

        <!-- Gmail Authentication Test -->
        <div class="glass rounded-xl p-6 mb-6 text-white">
            <h2 class="text-xl font-semibold mb-4">üîê Gmail Authentication Test</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Gmail Address:</label>
                    <input type="email" id="gmail-address" value="tuescalarina3@gmail.com"
                           class="w-full px-4 py-2 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70"
                           placeholder="your.email@gmail.com">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">App Password:</label>
                    <input type="password" id="app-password"
                           class="w-full px-4 py-2 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/70"
                           placeholder="xxxx xxxx xxxx xxxx">
                </div>
                <button onclick="testGmailAuth()"
                        class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">
                    Test Gmail Authentication
                </button>
                <div id="auth-result" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>
        </div>

        <!-- Email Operations Test -->
        <div class="glass rounded-xl p-6 mb-6 text-white">
            <h2 class="text-xl font-semibold mb-4">üìß Email Operations Test</h2>
            <div class="space-y-4">
                <button onclick="testEmailFetch()"
                        class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                    Fetch Test Emails
                </button>
                <button onclick="testSendEmail()"
                        class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
                    Send Test Email
                </button>
                <div id="email-result" class="mt-4 p-4 rounded-lg hidden"></div>
            </div>
        </div>

        <!-- Results Log -->
        <div class="glass-dark rounded-xl p-6 text-white">
            <h2 class="text-xl font-semibold mb-4">üìä Test Results Log</h2>
            <div id="test-log" class="font-mono text-sm space-y-1 max-h-64 overflow-y-auto">
                <div class="text-green-300">‚úÖ Test page loaded successfully</div>
            </div>
        </div>
    </div>

    <script>
        let sessionId = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-red-300' :
                              type === 'success' ? 'text-green-300' :
                              type === 'warning' ? 'text-yellow-300' : 'text-blue-300';
            logDiv.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus() {
            const statusGrid = document.getElementById('status-grid');
            statusGrid.innerHTML = `
                <div class="glass-dark rounded-lg p-4">
                    <div class="text-sm font-medium mb-1">Web App</div>
                    <div id="web-app-status" class="text-lg">üîÑ Checking...</div>
                </div>
                <div class="glass-dark rounded-lg p-4">
                    <div class="text-sm font-medium mb-1">Gmail Server</div>
                    <div id="gmail-server-status" class="text-lg">üîÑ Checking...</div>
                </div>
                <div class="glass-dark rounded-lg p-4">
                    <div class="text-sm font-medium mb-1">Session</div>
                    <div id="session-status" class="text-lg">üîí Not Authenticated</div>
                </div>
                <div class="glass-dark rounded-lg p-4">
                    <div class="text-sm font-medium mb-1">Integration</div>
                    <div id="integration-status" class="text-lg">‚ö†Ô∏è Pending</div>
                </div>
            `;

            // Check web app
            fetch('http://localhost:5173')
                .then(() => {
                    document.getElementById('web-app-status').innerHTML = '‚úÖ Running';
                    log('Web app is running on port 5173', 'success');
                })
                .catch(() => {
                    document.getElementById('web-app-status').innerHTML = '‚ùå Not Running';
                    log('Web app is not running on port 5173', 'error');
                });

            // Check Gmail server
            fetch('http://localhost:3012/health')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('gmail-server-status').innerHTML = '‚úÖ Running';
                    log('Gmail IMAP server is running on port 3012', 'success');
                })
                .catch(() => {
                    document.getElementById('gmail-server-status').innerHTML = '‚ùå Not Running';
                    log('Gmail IMAP server is not running on port 3012', 'error');
                });
        }

        async function testGmailAuth() {
            const email = document.getElementById('gmail-address').value;
            const appPassword = document.getElementById('app-password').value;
            const resultDiv = document.getElementById('auth-result');

            if (!email || !appPassword) {
                showResult(resultDiv, 'Please enter both Gmail address and App Password', 'error');
                return;
            }

            log('Testing Gmail authentication...', 'info');
            showResult(resultDiv, 'üîÑ Authenticating...', 'info');

            try {
                const response = await fetch('http://localhost:3012/api/gmail/authenticate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, appPassword })
                });

                const data = await response.json();

                if (response.ok) {
                    sessionId = data.sessionId;
                    document.getElementById('session-status').innerHTML = '‚úÖ Authenticated';
                    showResult(resultDiv, `‚úÖ Authentication successful! Session: ${data.sessionId}`, 'success');
                    log(`Gmail authentication successful for ${email}`, 'success');
                } else {
                    showResult(resultDiv, `‚ùå Authentication failed: ${data.message}`, 'error');
                    log(`Gmail authentication failed: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `‚ùå Network error: ${error.message}`, 'error');
                log(`Network error during authentication: ${error.message}`, 'error');
            }
        }

        async function testEmailFetch() {
            const resultDiv = document.getElementById('email-result');

            if (!sessionId) {
                showResult(resultDiv, '‚ùå Please authenticate first', 'error');
                return;
            }

            log('Fetching emails from Gmail...', 'info');
            showResult(resultDiv, 'üîÑ Fetching emails...', 'info');

            try {
                const response = await fetch(`http://localhost:3012/api/gmail/emails/${sessionId}?limit=10`);
                const data = await response.json();

                if (response.ok) {
                    showResult(resultDiv, `‚úÖ Successfully fetched ${data.emails.length} emails`, 'success');
                    log(`Successfully fetched ${data.emails.length} emails from Gmail`, 'success');

                    // Update integration status
                    document.getElementById('integration-status').innerHTML = '‚úÖ Working';
                } else {
                    showResult(resultDiv, `‚ùå Failed to fetch emails: ${data.message}`, 'error');
                    log(`Failed to fetch emails: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `‚ùå Network error: ${error.message}`, 'error');
                log(`Network error fetching emails: ${error.message}`, 'error');
            }
        }

        async function testSendEmail() {
            const resultDiv = document.getElementById('email-result');

            if (!sessionId) {
                showResult(resultDiv, '‚ùå Please authenticate first', 'error');
                return;
            }

            log('Sending test email...', 'info');
            showResult(resultDiv, 'üîÑ Sending test email...', 'info');

            try {
                const response = await fetch(`http://localhost:3012/api/gmail/send/${sessionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        to: 'tuescalarina3@gmail.com',
                        subject: 'üöÄ Gmail Integration Test - SUCCESS!',
                        body: `This is a test email from your productivity app's Gmail integration.

If you receive this email, your real Gmail integration is working perfectly!

üìß Sent: ${new Date().toLocaleString()}
üîß Integration: Real Gmail IMAP/SMTP
üéØ Status: CAREER-CRITICAL SUCCESS

This confirms your Gmail integration is ready for professional productivity boosting.

Best regards,
Your Productivity App`
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showResult(resultDiv, `‚úÖ Test email sent successfully! Message ID: ${data.messageId}`, 'success');
                    log(`Test email sent successfully. Message ID: ${data.messageId}`, 'success');
                } else {
                    showResult(resultDiv, `‚ùå Failed to send email: ${data.message}`, 'error');
                    log(`Failed to send test email: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `‚ùå Network error: ${error.message}`, 'error');
                log(`Network error sending email: ${error.message}`, 'error');
            }
        }

        function showResult(element, message, type) {
            element.className = `mt-4 p-4 rounded-lg ${
                type === 'success' ? 'bg-green-500/20 border border-green-400 text-green-100' :
                type === 'error' ? 'bg-red-500/20 border border-red-400 text-red-100' :
                'bg-blue-500/20 border border-blue-400 text-blue-100'
            }`;
            element.textContent = message;
            element.classList.remove('hidden');
        }

        // Initialize status check
        updateStatus();
        setInterval(updateStatus, 10000); // Check every 10 seconds

        log('Real Gmail Integration Test page initialized', 'success');
        log('Ready to test career-critical Gmail functionality', 'info');
    </script>
</body>
</html>