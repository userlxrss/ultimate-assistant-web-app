<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Auth Debug</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            line-height: 1.4;
        }
        .log-container {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover {
            background: #45a049;
        }
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
        }
        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196F3;
        }
    </style>
</head>
<body>
    <h1>üîç Supabase Authentication Debug Tool</h1>

    <div class="status info">
        <strong>Purpose:</strong> Debug the 400 error for user tuescalarina3@gmail.com<br>
        <strong>Project:</strong> vacwojgxafujscxuqmpg.supabase.co
    </div>

    <button id="runDebug" class="btn">Run Authentication Debug</button>
    <button id="clearLog" class="btn">Clear Log</button>

    <div class="log-container" id="logOutput">
        Debug output will appear here...
        Click "Run Authentication Debug" to start.
    </div>

    <div class="status info">
        <strong>What this tests:</strong>
        <ul>
            <li>‚úì API connectivity to Supabase</li>
            <li>‚úì User existence verification</li>
            <li>‚úì Password validation attempts</li>
            <li>‚úì Email verification status</li>
            <li>‚úì Password reset flow</li>
            <li>‚úì Session management</li>
        </ul>
    </div>

    <script src="debug-auth.js"></script>
    <script>
        const logOutput = document.getElementById('logOutput');
        const runDebugBtn = document.getElementById('runDebug');
        const clearLogBtn = document.getElementById('clearLog');

        // Override console.log to capture output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logOutput.textContent += args.join(' ') + '\n';
            logOutput.scrollTop = logOutput.scrollHeight;
        };

        // Override console.error to capture output
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            logOutput.textContent += '‚ùå ERROR: ' + args.join(' ') + '\n';
            logOutput.scrollTop = logOutput.scrollHeight;
        };

        // Override console.warn to capture output
        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logOutput.textContent += '‚ö†Ô∏è  WARNING: ' + args.join(' ') + '\n';
            logOutput.scrollTop = logOutput.scrollHeight;
        };

        runDebugBtn.addEventListener('click', async function() {
            logOutput.textContent = 'üöÄ Starting debug session...\n\n';
            runDebugBtn.disabled = true;
            runDebugBtn.textContent = 'Running Debug...';

            try {
                // Create a new script element to run the debug function
                const debugScript = document.createElement('script');
                debugScript.textContent = `
                    (async function debugSupabaseAuth() {
                        console.log('üîç Starting Supabase Authentication Debug');
                        console.log('===========================================');

                        // Load Supabase SDK
                        await loadSupabaseSDK();

                        // Initialize Supabase client
                        const supabaseUrl = 'https://vacwojgxafujscxuqmpg.supabase.co';
                        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhY3dvamd4YWZ1anNjeHVxbXBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxOTU5MTksImV4cCI6MjA3Nzc3MTkxOX0.RniyufeNXF9h6a9u55zGIxLRFeFDCaJxQ1ZjLv6KgxI';
                        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

                        const testEmail = 'tuescalarina3@gmail.com';
                        const testPasswords = ['test123', 'password', 'Test123!', 'Password123', 'admin123', 'tuescalarina3'];

                        console.log('üìß Testing user:', testEmail);
                        console.log('üîë Testing passwords:', testPasswords.join(', '));
                        console.log('');

                        // Test 1: Check if user exists by trying different passwords
                        console.log('üß™ Test 1: Checking user existence with various passwords');
                        for (const password of testPasswords) {
                            try {
                                console.log(\`Testing password: "\${password}"\`);
                                const { data, error } = await supabase.auth.signInWithPassword({
                                    email: testEmail,
                                    password: password
                                });

                                if (error) {
                                    console.log(\`‚ùå Error: \${error.message}\`);
                                    console.log(\`   Error code: \${error.status}\`);
                                    console.log(\`   Error details:\`, error);
                                } else {
                                    console.log(\`‚úÖ SUCCESS! Password found: "\${password}"\`);
                                    console.log('User data:', data);
                                    break;
                                }
                                console.log('');
                            } catch (err) {
                                console.log(\`‚ùå Exception: \${err.message}\`);
                                console.log('');
                            }
                        }

                        // Test 2: Try to sign up with the same email to see what happens
                        console.log('üß™ Test 2: Attempting to recreate user to check existence');
                        try {
                            const { data, error } = await supabase.auth.signUp({
                                email: testEmail,
                                password: 'TestPassword123!',
                                options: {
                                    data: {
                                        full_name: 'Debug Test',
                                        username: 'debugtest'
                                    }
                                }
                            });

                            if (error) {
                                console.log('‚úÖ User exists (signup failed as expected):', error.message);
                            } else {
                                console.log('User created (unexpected):', data);
                            }
                        } catch (err) {
                            console.log('Exception during signup test:', err.message);
                        }

                        // Test 3: Check current session
                        console.log('üß™ Test 3: Checking current session');
                        try {
                            const { data: { session }, error } = await supabase.auth.getSession();
                            if (session) {
                                console.log('‚úÖ Active session found:', session.user.email);
                            } else {
                                console.log('‚ùå No active session');
                            }
                        } catch (err) {
                            console.log('Exception checking session:', err.message);
                        }

                        // Test 4: Test password reset flow
                        console.log('üß™ Test 4: Testing password reset request');
                        try {
                            const { data, error } = await supabase.auth.resetPasswordForEmail(testEmail);
                            if (error) {
                                console.log('‚ùå Password reset failed:', error.message);
                            } else {
                                console.log('‚úÖ Password reset email sent successfully');
                            }
                        } catch (err) {
                            console.log('Exception during password reset:', err.message);
                        }

                        console.log('');
                        console.log('üèÅ Debug session completed');
                        console.log('===========================================');

                        // Helper function to load Supabase SDK
                        async function loadSupabaseSDK() {
                            return new Promise((resolve, reject) => {
                                if (window.supabase) {
                                    resolve();
                                    return;
                                }

                                const script = document.createElement('script');
                                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                                script.async = true;
                                script.onload = () => {
                                    console.log('‚úÖ Supabase SDK loaded for debugging');
                                    resolve();
                                };
                                script.onerror = () => {
                                    reject(new Error('Failed to load Supabase SDK'));
                                };
                                document.head.appendChild(script);
                            });
                        }
                    })();
                `;
                document.head.appendChild(debugScript);
                debugScript.onload = () => {
                    setTimeout(() => {
                        runDebugBtn.disabled = false;
                        runDebugBtn.textContent = 'Run Authentication Debug';
                        logOutput.textContent += '\n‚úÖ Debug completed!\n';
                    }, 10000); // Give it 10 seconds to complete
                };
            } catch (error) {
                console.error('Failed to run debug:', error);
                runDebugBtn.disabled = false;
                runDebugBtn.textContent = 'Run Authentication Debug';
            }
        });

        clearLogBtn.addEventListener('click', function() {
            logOutput.textContent = 'Log cleared. Ready for new debug session...\n';
        });

        // Initial message
        console.log('üîß Debug tool ready. Click "Run Authentication Debug" to start.');
    </script>
</body>
</html>